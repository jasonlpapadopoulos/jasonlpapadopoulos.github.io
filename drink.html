<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.75">
    <title>Plana - Drink in New York City</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="mystyles.css">
    <!-- <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background-color: black;
            color: white;
            font-family: 'Roboto', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        .results-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .place-box {
            background-color: black;
            color: white;
            padding: 20px;
            border: 2px solid white;
            border-radius: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        .place-box img {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
        }
        .choice-button {
            background-color: black;
            color: white;
            border: 1px solid white;
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .choice-button:hover {
            background-color: white;
            color: black;
        }
        /* .filters-container {
            margin-bottom: 30px;
            width: 100%;
            max-width: 800px;
            display: flex;
            gap: 15px;
            justify-content: center;
        } */
        .filters-container {
            margin-bottom: 30px;
            justify-content: center;
            gap: 15px;
            position: sticky;
            top: 0;
            display: flex;
            background-color: black; /* Ensure background covers content when scrolling */
            z-index: 10; /* Keep filters above scrolling content */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Optional: adds a subtle shadow */
            padding-bottom: 10px;
        }
        .filter-group {
            position: relative;
            min-width: 150px;
        }
        .filter-button {
            width: 100%;
            padding: 12px 20px;
            background-color: #202020;
            border: 2px solid white;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .filter-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .filter-button.active {
            background-color: white;
            color: black;
        }
        .filter-options {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            width: 120%;
            background-color: rgb(20, 20, 20);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        .filter-options.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .filter-option {
            display: flex;
            align-items: center;
            padding: 8px 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 8px;
        }
        .filter-option:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .filter-option input {
            margin-right: 10px;
            cursor: pointer;
        }
        .filter-option input[type="radio"],
        .filter-option input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid white;
            border-radius: 50%;
            outline: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .filter-option input[type="checkbox"] {
            border-radius: 4px;
        }
        .filter-option input[type="radio"]:checked,
        .filter-option input[type="checkbox"]:checked {
            background-color: white;
            position: relative;
        }
        .filter-option input[type="radio"]:checked::after,
        .filter-option input[type="checkbox"]:checked::after {
            content: "";
            width: 8px;
            height: 8px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
        }
        .filter-button.modified {
            background-color: gray;
        }
        
        .price-slider {
            width: 100%;
            padding: 15px;
        }
        
        .price-range {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .price-range span {
            flex: 1;
            text-align: center;
        }
        
        .dual-range {
            position: relative;
            width: 100%;
            height: 30px;
        }
        
        .dual-range input[type="range"] {
            position: absolute;
            width: 100%;
            pointer-events: none;
            appearance: none;
            height: 2px;
            background: none;
            opacity: 0;
        }
        
        .dual-range input[type="range"]::-webkit-slider-thumb {
            pointer-events: auto;
            appearance: none;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }
        .section-content {
    display: none;
    padding-left: 20px;
}

.section-content.open {
    display: block;
}

.section-header {
    cursor: pointer;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.section-header .arrow {
    transition: transform 0.3s ease;
}

.section-header.active .arrow {
    transform: rotate(180deg);
}

/* .cuisine-list {
    margin-top: 10px;
} */

.select-all-section {
    margin-bottom: 10px;
}
.fixed-line {
            position: absolute; /* Changed from fixed to absolute */
            left: 0; /* Spans full width from left edge */
            width: 100%; /* Full width */
            height: 2px; /* Thin line, adjust as needed */
            background-color: white; /* White color */
            bottom: 0; /* Position at the bottom of the container */
            /* margin-top: 10px; */
            /* margin-bottom: 10px; */
        }
    </style> -->
</head>
<body>
<div class="results-container">
    <div class="filters-container">
        <div class="filter-group">
            <button class="filter-button" data-filter="setting">Setting</button>
            <div class="filter-options">
                <label class="filter-option">
                    <input type="checkbox" name="setting" value="cocktail"> Cocktail Bar
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="setting" value="dive"> Dive Bar
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="setting" value="jazz"> Live Jazz
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="setting" value="rooftop"> Rooftop
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="setting" value="speakeasy"> Speakeasy
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="setting" value="beer"> Beer Hall
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="setting" value="pub"> Pub
                </label>
            </div>
        </div>
        <div class="filter-group">
            <button class="filter-button" data-filter="price">Price Range</button>
            <div class="filter-options">
                <label class="filter-option">
                    <input type="checkbox" name="price" value="$"> $
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="price" value="$$"> $$
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="price" value="$$$"> $$$
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="price" value="$$$$"> $$$$
                </label>
            </div>
        </div>
        <div class="filter-group">
            <button class="filter-button" data-filter="servesFood">Serves Food?</button>
            <div class="filter-options">
                <label class="filter-option">
                    <input type="checkbox" name="servesFood" value="yes"> Yes
                </label>
            </div>
        </div>
        <div class="fixed-line"></div>
    </div>
    <div id="bar-list"></div>
</div>

<script>
class RestaurantDisplay {
    constructor() {
        this.bars = [];
        this.selectedPrices = new Set();
        this.selectedSettings = new Set();
        // this.selectedCuisines = new Set();
    }

    parseCSV(csvText) {
        const lines = csvText.split('\n');
        const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
        
        return lines.slice(1)
            .filter(line => line.trim())
            .map(line => {
                const values = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)
                    .map(val => val.replace(/"/g, '').trim());
                
                return headers.reduce((obj, header, index) => {
                    obj[header] = values[index];
                    return obj;
                }, {});
            });
    }

    async fetchRestaurants(csvUrl) {
        try {
            const response = await fetch(csvUrl);
            const csvText = await response.text();
            this.bars = this.parseCSV(csvText);
            return this.bars;
        } catch (error) {
            console.error('Error fetching bar data:', error);
            return [];
        }
    }

    getSelectedNeighborhoods() {
        const selectedNeighborhoods = localStorage.getItem('selectedNeighborhoods');
        return selectedNeighborhoods ? JSON.parse(selectedNeighborhoods) : [];
    }

    filterBars() {
        const selectedNeighborhoods = this.getSelectedNeighborhoods();
        if (selectedNeighborhoods.length === 0) return [];
        
        return this.bars.filter(bar => {
            const neighborhoodMatch = selectedNeighborhoods.includes(bar.neighborhood);
            const priceMatch = this.selectedPrices.size === 0 || this.selectedPrices.has(bar.budget);
            const settingMatch = this.selectedSettings.size === 0 || [...this.selectedSettings].some(setting => 
                bar[setting.toLowerCase()] === "1"
            );
            // const cuisineMatch = this.selectedCuisines.size === 0 || 
            //                    this.selectedCuisines.has(bar.cuisine.toLowerCase());

            return neighborhoodMatch && priceMatch && settingMatch;
            //  && cuisineMatch;
        });
    }

    createRestaurantBox(bar) {
        const box = document.createElement('div');
        box.className = 'place-box';
        
        box.innerHTML = `
            <strong>${bar.place_name}</strong><br>
            <i>${bar.budget}</i><br><br>
            
            <a href="${bar.image_url}">
                <img src="${bar.image_url}" alt="${bar.place_name}" 
                     onerror="this.src='https://www.budget101.com/images/image-not-available.png?6068''">
            </a><br><br>
            
            ${bar.description}<br><br>
            
            <a href="${bar.maps_url}" target="_blank">
                <button class="choice-button">See in Maps</button>
            </a>
            ${bar.reservation_url ? `
                <a href="${bar.reservation_url}" target="_blank">
                    <button class="choice-button">Reserve</button>
                </a>
            ` : ''}
        `;
        
        return box;
    }

    updateDisplay() {
        const filteredRestaurants = this.filterBars();
        const container = document.getElementById('bar-list');
        container.innerHTML = '';

        if (filteredRestaurants.length === 0) {
            const noResultsMessage = document.createElement('p');
            noResultsMessage.textContent = 'No bars found. Please adjust your search settings.';
            container.appendChild(noResultsMessage);
        } else {
            filteredRestaurants.forEach(bar => {
                container.appendChild(this.createRestaurantBox(bar));
            });
        }
    }

    setupEventListeners() {
        // Price filter listeners
        const priceCheckboxes = document.querySelectorAll('input[name="price"]');
        priceCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    this.selectedPrices.add(checkbox.value);
                } else {
                    this.selectedPrices.delete(checkbox.value);
                }
                this.updateDisplay();
            });
        });

        // Setting filter listeners
        const settingCheckboxes = document.querySelectorAll('input[name="setting"]');
        settingCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    this.selectedSettings.add(checkbox.value);
                } else {
                    this.selectedSettings.delete(checkbox.value);
                }
                this.updateDisplay();
            });
        });

        // Cuisine filter listeners
        // const cuisineCheckboxes = document.querySelectorAll('input[name="cuisine"]');
        // cuisineCheckboxes.forEach(checkbox => {
        //     checkbox.addEventListener('change', () => {
        //         if (checkbox.checked) {
        //             this.selectedCuisines.add(checkbox.value.toLowerCase());
        //         } else {
        //             this.selectedCuisines.delete(checkbox.value.toLowerCase());
        //         }
        //         this.updateDisplay();
        //     });
        // });

        // Filter button listeners
        const filterButtons = document.querySelectorAll('.filter-button');
        filterButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const filterGroup = button.closest('.filter-group');
                const options = filterGroup.querySelector('.filter-options');
                const wasActive = button.classList.contains('active');

                // Close all other filter options
                document.querySelectorAll('.filter-options').forEach(opt => {
                    opt.classList.remove('show');
                });
                document.querySelectorAll('.filter-button').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Toggle current filter
                if (!wasActive) {
                    options.classList.add('show');
                    button.classList.add('active');
                }
            });
        });

        // Close filters when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.filter-group')) {
                document.querySelectorAll('.filter-options').forEach(opt => {
                    opt.classList.remove('show');
                });
                document.querySelectorAll('.filter-button').forEach(btn => {
                    btn.classList.remove('active');
                });
            }
        });
    }
}

// Initialize display and add event listeners
document.addEventListener('DOMContentLoaded', async function() {
    const display = new RestaurantDisplay();
    await display.fetchRestaurants('https://raw.githubusercontent.com/jasonlpapadopoulos/jasonlpapadopoulos.github.io/main/drink_places.csv');
    display.setupEventListeners();
    display.updateDisplay();
});
</script>
</body>
</html>
